# Binary Sample Oracle Configuration
# Comprehensive compilation matrix for ML training data generation

oracle:
  output_dir: ./output
  parallel_jobs: 8
  continue_on_error: true
  log_level: info
  checksum_binaries: true

# Target architectures and their configurations
targets:
  # x86/x64 Family
  - triple: x86_64-unknown-linux-gnu
    enabled: true
    cpu_options: [generic, x86-64, x86-64-v2, x86-64-v3, x86-64-v4, skylake, znver3]

  - triple: x86_64-unknown-linux-musl
    enabled: true
    cpu_options: [generic, x86-64-v2, x86-64-v3]

  - triple: i686-unknown-linux-gnu
    enabled: true
    cpu_options: [generic, pentium4, core2]

  - triple: x86_64-apple-darwin
    enabled: true
    cpu_options: [generic, haswell, skylake]

  # ARM Family
  - triple: aarch64-unknown-linux-gnu
    enabled: true
    cpu_options: [generic, cortex-a53, cortex-a72, apple-m1]

  - triple: aarch64-unknown-linux-musl
    enabled: true
    cpu_options: [generic, cortex-a72]

  - triple: aarch64-apple-darwin
    enabled: true
    cpu_options: [apple-m1, apple-m2]

  - triple: arm-unknown-linux-gnueabihf
    enabled: true
    cpu_options: [generic, cortex-a7, cortex-a15]

  - triple: armv7-unknown-linux-gnueabihf
    enabled: true
    cpu_options: [generic, cortex-a9]

  - triple: thumbv7m-none-eabi
    enabled: true
    is_freestanding: true
    cpu_options: [cortex-m3, cortex-m4]

  # RISC-V Family
  - triple: riscv64-unknown-linux-gnu
    enabled: true
    cpu_options: [generic-rv64, rocket-rv64]

  - triple: riscv32-unknown-elf
    enabled: true
    is_freestanding: true
    cpu_options: [generic-rv32]

  # MIPS Family
  - triple: mips-unknown-linux-gnu
    enabled: true
    cpu_options: [mips32, mips32r2]

  - triple: mips64-unknown-linux-gnuabi64
    enabled: true
    cpu_options: [mips64, mips64r2]

  - triple: mipsel-unknown-linux-gnu
    enabled: true
    cpu_options: [mips32, mips32r2]

  # PowerPC Family
  - triple: powerpc64-unknown-linux-gnu
    enabled: true
    cpu_options: [ppc64, pwr8]

  - triple: powerpc64le-unknown-linux-gnu
    enabled: true
    cpu_options: [ppc64le, pwr9]

  # System Z (s390x)
  - triple: s390x-unknown-linux-gnu
    enabled: true
    cpu_options: [z13, z14]

  # SPARC
  - triple: sparc64-unknown-linux-gnu
    enabled: true
    cpu_options: [v9]

  # LoongArch
  - triple: loongarch64-unknown-linux-gnu
    enabled: true
    cpu_options: [la464]

  # WebAssembly
  - triple: wasm32-unknown-unknown
    enabled: true
    is_freestanding: true

  - triple: wasm32-wasi
    enabled: true

  - triple: wasm64-unknown-unknown
    enabled: false  # Limited support

  # Embedded/Specialized
  - triple: avr-unknown-unknown
    enabled: true
    is_freestanding: true
    cpu_options: [atmega328p, atmega2560]

  - triple: msp430-unknown-elf
    enabled: true
    is_freestanding: true

  - triple: hexagon-unknown-linux-musl
    enabled: true
    cpu_options: [hexagonv66]

  # GPU Targets
  - triple: nvptx64-nvidia-cuda
    enabled: false  # Requires CUDA
    is_freestanding: true

  - triple: amdgcn-amd-amdhsa
    enabled: false  # Requires ROCm
    is_freestanding: true

  # Other
  - triple: bpf-unknown-none
    enabled: true
    is_freestanding: true

# Programs configuration
programs:
  source_dir: ./programs
  include_patterns:
    - "*.c"
    - "*.cpp"
  exclude_patterns:
    - "*_test.c"
    - "*_test.cpp"

  # Category-specific exclusions for incompatible targets
  category_exclusions:
    # Exclude syscall programs from freestanding targets
    syscall_*:
      exclude_if: is_freestanding

    # Exclude C++ exception handling from targets without exception support
    cf_exception.cpp:
      exclude_if: no_exceptions

    # Exclude inline assembly from incompatible architectures
    asm_*:
      # Each program has internal arch guards, but may fail on some targets
      warn_on_failure: true

# Compilation configuration matrix
configurations:
  optimization:
    - O0        # No optimization (debug-friendly)
    - O1        # Basic optimization
    - O2        # Standard optimization
    - O3        # Aggressive optimization
    - Os        # Optimize for size
    - Oz        # Aggressive size optimization
    # - Ofast    # Fast math (may cause issues)

  debug_info:
    - none
    - line-tables-only  # Minimal debug info
    - dwarf4            # Full DWARF4
    # - dwarf5          # DWARF5 (newer)

  lto:
    - none
    - thin              # ThinLTO
    # - full            # Full LTO (slow)

  pic:
    - none
    - pic               # Position Independent Code
    # - pie             # Position Independent Executable

  stack_protection:
    - none
    - basic             # -fstack-protector
    # - strong          # -fstack-protector-strong
    # - all             # -fstack-protector-all

  sanitizers:
    - none
    # Sanitizers generally for native target only
    # - asan
    # - ubsan

  c_standard:
    - c11               # Default
    - c99
    # - c17
    # - gnu11

  cpp_standard:
    - c++17             # Default for C++ files
    - c++14
    # - c++20

# Configuration filtering rules
filters:
  # Embedded targets get stripped-down configs
  - condition:
      is_freestanding: true
    apply:
      optimization: [O0, O2, Os]
      debug_info: [none]
      lto: [none]
      pic: [none]
      stack_protection: [none]
      exclude_programs:
        - "syscall_*"
        - "cpp_*"

  # WebAssembly specific
  - condition:
      arch: wasm32
    apply:
      optimization: [O0, O2, Os, Oz]
      debug_info: [none, dwarf4]
      lto: [none]
      pic: [none]
      exclude_programs:
        - "syscall_*"
        - "asm_*"

  # GPU targets
  - condition:
      arch_in: [nvptx64, amdgcn]
    apply:
      optimization: [O0, O2, O3]
      debug_info: [none]
      exclude_programs:
        - "syscall_*"
        - "cpp_*"
        - "asm_*"

# Output configuration
output:
  structure: hierarchical  # {target}/{config}/{binary}
  manifest: manifest.json
  statistics: statistics.json
  per_binary_metadata: true
  binary_extension: ""  # Empty for ELF, could be set per-target

  # Compression for final archive
  compress: false
  compression_format: tar.zst

# Validation settings
validation:
  verify_binaries: true      # Check that output is valid binary
  min_binary_size: 100       # Minimum valid binary size in bytes
  max_binary_size: 104857600 # Maximum binary size (100MB)
  check_sections: true       # Verify expected sections exist

# Presets for quick configuration
presets:
  minimal:
    description: "Quick test build with limited configs"
    targets:
      - x86_64-unknown-linux-gnu
      - aarch64-unknown-linux-gnu
    configurations:
      optimization: [O0, O2]
      debug_info: [none]
      lto: [none]
      pic: [none]

  standard:
    description: "Balanced build for most use cases"
    targets: all_enabled
    configurations:
      optimization: [O0, O2, O3, Os]
      debug_info: [none, dwarf4]
      lto: [none, thin]
      pic: [none, pic]

  comprehensive:
    description: "Full configuration matrix"
    targets: all
    configurations: all
